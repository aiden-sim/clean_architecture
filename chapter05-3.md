# 22장 클린 아키텍처
### 서론
  - 지난 수십 년간 육각형 아키텍처, DCI, BCE등 여러가지 시스템 아키텍처가 존재
    - 이들의 목표는 관심사의 분리다.
    - 이들 아키텍처 모두 시스템이 다음과 같은 특징을 지니게 만듬
      - 프레임워크 독립성 : 프레임워크의 존재 여부에 의존하지 않음
      - 테스트 용이성 : 외부 요소가 없이도 테스트 가능
      - UI 독립성 : 시스템 나머지 부분 변경없이 UI를 쉽게 변경 가능
      - 데이터베이스 독립성 : 데이터베이스에 결합되지 않기 때문에 여러 DB로 교체 가능
      - 모든 외부 에이전시에 대한 독립성 : 업무 규칙은 외부 세계와의 인터페이스에 대해 전혀 알지 못함

  - 클린 아키텍처
    - ![클린아키텍처](https://user-images.githubusercontent.com/7076334/99390482-0aaf0f00-291c-11eb-8c59-118ce939fd43.jpeg)

### 의존성 규칙
  - 바깥쪽 원은 메커니즘(저수준)이고, 안쪽 원은 정책(고수준)이다.
  - 이런 아키텍처가 동작하도록 하는 가장 중요한 규칙은 의존성 규칙이다.
    - 소스 코드 의존성은 반드시 안쪽으로, 고수준의 정책을 향해야된다.
  - 내부 원에 속한 요소는 외부 원에 속한 어떤 것도 알면 안된다.
 
### 엔티티
  - 엔티티는 전사적인 핵심 엄무 규칙을 캡슐화한다.
  - 다양한 애플리케이션에서 엔티티를 재사용할 수 있다면, 형태는 중요하지 않다.
  - 단순한 단일 애플리케이션 경우 엔티티는 업무 객체가된다. (고수준)
  - 운영 관점에서 특정 애플리케이션의 변경이 엔티티 계층에 절대로 영향을 주어서는 안된다.
  
### 유스케이스
  - 유스케이스는 애플리케이션에 특화된 업무 규칙을 포함한다.
  - 유스케이스는 엔티티로 들어오고 나가는 데이터 흐름을 조정하며, 엔티티가 자신의 핵심 업무 규칙을 사용해서 유스케이스의 목적 달성하도록 도와준다.
  - 유스케이스의 변경이 엔티티에 영향을 줘서는 안 된다.
  - 데이터 베이스, UI등 외부 요소 변경이 유스케이스에 영향을 줘서도 안 된다.
  - 운영 관점에서 애플리케이션의 변경된다면 유스케이스가 영향을 받는다.
  
### 인터페이스 어댑터
  - 일련의 어댑터들로 구성되어 있고, 어댑터는 유스케이스와 엔티티에게 가장 편리한 형식에서 데이터베이스나 웹 같은 외부 에이전시에게 가장 편리한 형식으로 변환
    - MVC 아키켁처를 모두 포괄 (프리젠터, 뷰, 컨트롤러)
  - 데이터를 유스케이스에게 가장 편리한 형식에서 영속성용으로 사용 중인 임의 프레임워크(데이터베이스)가 이용하기에 가장 편리한 형식으로 변환
    - 이 계층의 어떤 코드도 데이터베이스에 대해 절대 알아서 안된다.
  - 데이터를 외부 서비스와 같은 외부적인 형식에서 유스케이스나 엔티티에서 사용되는 내부적인 형식으로 변환하는 또 다른 어댑터가 필요
  
### 프레임워크와 드라이버
  - 데이터베이스나 웹 프레임워크 같은 프레임워크나 도구들로 구성된다.
  - 안쪽 원과 접합 코드 외에는 특별한 코드가 많지 않다.
  - 웹, 데이터베이스 같은 세부사항이 위치한다.
  
### 원은 네 개여야만 하나?
  - 네 개만 사용해야된다는 규칙은 없으나 어떤 경우에도 의존성 규칙은 적용된다.
    - 의존성은 항상 안쪽을 향한다. (저수준 -> 고수준)
  
### 경계 횡단하기
  - 그림 22.1 에서 제어 흐름은 컨트롤러에서 시작해, 유스케이스를 지난 후, 프레젠터에서 실행되며 마무리된다.
  - 각 의존성은 유스케이스를 향해 안쪽을 가리킨다.
  - 이처럼 제어흐름과 의존성의 방향이 반대여야 하는 경우 대체로 의존성 역전 원칙을 사용하여 해결한다.
    - 제어흐름을 따라 구현하면 안쪽 원의 코드가 바깥쪽 원의 코드를 호출하게 되는데 의존성을 역전시켜서, 바깥쪽의 원이 안쪽 원의 코드를 호출하게 만든다.
  - 동적 다형성을 이용하여 소스 코드 의존성을 제어흐름과 반대로 만들 수 있고, 이를 통해 제어흐름이 어느 방향으로 흐르더라도 의존성 규칙을 준수할 수 있다.
  
### 경계를 횡단하는 데이터는 어떤 모습일가

  
